-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.tipo_mascota
(
    idtipo_mascota integer NOT NULL,
    descripcion character(45),
    PRIMARY KEY (idtipo_mascota)
);

CREATE TABLE IF NOT EXISTS public.mascota
(
    idmascota integer NOT NULL,
    nombre character(45) NOT NULL,
    tipo_mascota integer NOT NULL,
    propieatario integer,
    CONSTRAINT pk_mascota PRIMARY KEY (idmascota)
);

CREATE TABLE IF NOT EXISTS public.propietario
(
    idpropietario integer NOT NULL,
    nombre character(45) NOT NULL,
    direccion character(45) NOT NULL,
    telefono character(10) NOT NULL,
    correo character(60) NOT NULL,
    comentarios text,
    PRIMARY KEY (idpropietario)
);

ALTER TABLE IF EXISTS public.mascota
    ADD CONSTRAINT fk_tipo_mascota FOREIGN KEY (tipo_mascota)
    REFERENCES public.tipo_mascota (idtipo_mascota) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.mascota
    ADD CONSTRAINT fk_id_propietario FOREIGN KEY (propieatario)
    REFERENCES public.propietario (idpropietario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;

SELECT * FROM mascota;

SELECT * FROM mascota where mascota.propieatario is null;

SELECT tipo_mascota.idtipo_mascota, tipo_mascota.descripcion, count(tipo_mascota.idtipo_mascota) AS nro_mascotas 
FROM tipo_mascota, mascota where tipo_mascota.idtipo_mascota = mascota.idmascota GROUP BY tipo_mascota.idtipo_mascota, tipo_mascota.descripcion;  

SELECT propietario.idpropietario, propietario.nombre, propietario.direccion, propietario.telefono, propietario.correo, propietario.comentarios, count(*) as nro_mascotas_propietario
FROM propietario, mascota where propietario.idpropietario = mascota.idmascota GROUP BY propietario.idpropietario HAVING COUNT(*) > 1;